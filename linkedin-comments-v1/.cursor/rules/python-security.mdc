---
description: Security best practices and vulnerability prevention
globs: ["**/*.py"]
---

# Python Security Standards

## Secrets Management
- Never hardcode secrets, passwords, API keys
- Use environment variables for configuration
- Use `python-dotenv` for local development
- Use secrets management services in production

```python
import os
from pathlib import Path

def get_api_key() -> str:
    """Get API key from environment."""
    api_key = os.getenv("API_KEY")
    if not api_key:
        msg = "API_KEY environment variable not set"
        raise ValueError(msg)
    return api_key
```

## Input Validation

- Validate and sanitize all external inputs
- Use parameterized queries for SQL
- Avoid ⁠eval(), ⁠exec(), ⁠pickle with untrusted data
- Use ⁠secrets module for cryptographic randomness

```python
import secrets

def generate_token() -> str:
    """Generate secure random token."""
    return secrets.token_urlsafe(32)
```

## File Operations

- Validate file paths
- Check file permissions
- Use context managers
- Specify encoding explicitly

```python
from pathlib import Path

def read_file(path: Path) -> str:
    """Read file with proper validation."""
    if not path.exists():
        msg = f"File not found: {path}"
        raise FileNotFoundError(msg)

    if not path.is_file():
        msg = f"Not a file: {path}"
        raise ValueError(msg)

    return path.read_text(encoding="utf-8")
```

## Common Vulnerabilities (Avoid)

```python
# ❌ Hardcoded secrets
API_KEY = "sk-1234567890"  # pragma: allowlist secret

# ❌ SQL injection
query = f"SELECT * FROM users WHERE id = {user_id}"

# ❌ Command injection
os.system(f"ls {user_input}")

# ❌ Using pickle with untrusted data
data = pickle.loads(untrusted_input)
```
